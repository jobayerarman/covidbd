<script>
    // moment-range initialization
    window['moment-range'].extendMoment(moment);
    let now = moment().format('YYYY-MM-DD');
    let range = moment().range('2020-03-08', now);
    let dateArray = Array.from(range.by('days'));

    let dates = dateArray.map((m) => {
        return m.format('YYYY-MM-DD');
    });

    let dateLabels = [
        '১ মার্চ',
        '৮ মার্চ',
        '১৫ মার্চ',
        '১৬ মার্চ',
        '১৭ মার্চ',
        '১৮ মার্চ',
        '১৯ মার্চ',
        '২০ মার্চ',
        '২১ মার্চ',
        '২২ মার্চ',
        '২৩ মার্চ',
        '২৪ মার্চ',
        '২৫ মার্চ',
        '২৬ মার্চ',
        '২৭ মার্চ',
        '২৮ মার্চ',
        '২৯ মার্চ',
        '৩০ মার্চ',
        '৩১ মার্চ',
        '১ এপ্রিল',
        '২ এপ্রিল',
        '৩ এপ্রিল',
        '৪ এপ্রিল',
        '৫ এপ্রিল',
        '৬ এপ্রিল',
        '৭ এপ্রিল',
        '৮ এপ্রিল',
        '৯ এপ্রিল',
        '১০ এপ্রিল',
        '১১ এপ্রিল',
        '১২ এপ্রিল',
        '১৩ এপ্রিল',
        '১৪ এপ্রিল',
        '১৫ এপ্রিল',
        '১৬ এপ্রিল',
        '১৭ এপ্রিল',
        '১৮ এপ্রিল',
        '১৯ এপ্রিল',
        '২০ এপ্রিল',
        '২১ এপ্রিল',
        '২২ এপ্রিল',
        '২৩ এপ্রিল',
        '২৪ এপ্রিল',
        '২৫ এপ্রিল',
        '২৬ এপ্রিল',
        '২৭ এপ্রিল',
        '২৮ এপ্রিল',
    ];

    let deathData = {
        labels: dateLabels,
        datasets: [
            {
                label: 'মোট মৃত্যুর সংখ্যা',
                backgroundColor: 'rgb(243, 58, 63)',
                borderColor: 'rgb(243, 58, 63)',
                fill: false,
                data: [
                    0,
                    0,
                    0,
                    0,
                    0,
                    1,
                    1,
                    1,
                    2,
                    2,
                    3,
                    4,
                    5,
                    5,
                    5,
                    5,
                    5,
                    5,
                    5,
                    6,
                    6,
                    6,
                    8,
                    9,
                    12,
                    17,
                    20,
                    21,
                    27,
                    30,
                    34,
                    39,
                    46,
                    50,
                    60,
                    75,
                    84,
                    91,
                    101,
                    110,
                    120,
                    127,
                    131,
                    140,
                    145,
                    152,
                    155,
                ],
            },
        ],
    };

    let deathConfig = {
        // The type of chart we want to create
        type: 'line',

        // The data for our dataset
        data: deathData,

        // Configuration options go here
        options: {
            responsive: true,
            maintainAspectRatio: false,
            title: {
                display: true,
                fontSize: 20,
                text: 'মোট মৃত্যুর সংখ্যা',
            },
            legend: {
                position: 'bottom',
            },
            tooltips: {
                mode: 'index',
                intersect: false,
            },
        },
    };

    let casesConfig = {
        type: 'line',
        data: {
            labels: [
                <% timelineDailyCases.forEach(function (cases) { %>
                    moment('<%= cases.date %>').format('YYYY-MM-DD'),
                <% }); %>
            ],
            datasets: [
                {
                    label: 'নতুন শনাক্ত',
                    backgroundColor: 'rgb(250, 196, 29)',
                    borderColor: 'rgb(250, 196, 29)',
                    fill: false,
                    data: [
                        <% timelineDailyCases.forEach(function (cases) { %>
                            {
                                x: moment('<%= cases.date %>', 'MM-DD-YY'),
                                y: <%= cases.count %>
                            },
                        <% }); %>
                    ],
                },
                {
                    label: 'মোট শনাক্ত',
                    backgroundColor: 'rgb(241, 118, 0)',
                    borderColor: 'rgb(241, 118, 0)',
                    fill: false,
                    data: [
                        <% timelineTotalCases.forEach(function (cases) { %>
                            {
                                x: moment('<%= cases.date %>', 'MM-DD-YY'),
                                y: <%= cases.count %>
                            },
                        <% }); %>
                    ],
                },
            ],
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            title: {
                display: true,
                fontSize: 20,
                text: 'নতুন ও মোট শনাক্তের সংখ্যা',
            },
            legend: {
                position: 'bottom',
            },
            tooltips: {
                mode: 'index',
                intersect: false,
            },
            scales: {
                xAxes: [
                    {
                        type: 'time',
                        time: {
                            unit: 'day',
                        },
                        scaleLabel: {
                            display: true,
                            labelString: 'তারিখ',
                        },
                    },
                ],
                yAxes: [
                    {
                        scaleLabel: {
                            display: true,
                            labelString: 'সংখ্যা',
                        },
                    },
                ],
            },
        },
    };

    // pie chart - cases, deaths and recovered
    let pieChartOneData = {
        labels: ['শনাক্ত', 'মৃত্যু', 'সুস্থ'],
        datasets: [{
            label: 'Dataset 1',
            backgroundColor: ['rgb(241, 118, 0)', 'rgb(243, 58, 63)', 'rgb(58, 167, 69)'],
            data: [<%= totalCasesEn %>, <%= totalDeathsEn %>, <%= totalRecoveredEn %>],
        }]
    };

    let pieChartOneConfig = {
        type: 'doughnut',

        data: pieChartOneData,

        options: {
            responsive: true,
            maintainAspectRatio: false,
            title: {
                display: true,
                fontSize: 20,
                padding: 30,
                text: 'মোট শনাক্ত, মৃত্যু ও সুস্থ',
            },
            legend: {
                position: 'bottom',
                labels: {
                    fontSize: 14,
                    padding: 30
                }
            },
        }
    };
    // pie chart - tests and cases
    let pieChartTwoData = {
        labels: ['পরীক্ষা', 'শনাক্ত'],
        datasets: [{
            label: 'Dataset 1',
            backgroundColor: ['rgb(35, 162, 184)', 'rgb(241, 118, 0)'],
            data: [<%= totalTestsEn %>, <%= totalCasesEn %>],
        }]
    };

    let pieChartTwoConfig = {
        type: 'doughnut',

        data: pieChartTwoData,

        options: {
            responsive: true,
            maintainAspectRatio: false,
            title: {
                display: true,
                fontSize: 20,
                padding: 30,
                text: 'মোট পরীক্ষা ও শনাক্ত',
            },
            legend: {
                position: 'bottom',
                labels: {
                    fontSize: 14,
                    padding: 30
                }
            },
        }
    };

    window.onload = function () {
        let coronaCases = document.getElementById('coronaCasesByTime').getContext('2d');
        window.coronaCases = new Chart(coronaCases, casesConfig);

        let coronaDeaths = document.getElementById('coronaDeathByTime').getContext('2d');
        window.coronaDeaths = new Chart(coronaDeaths, deathConfig);

        let pieChartOne = document.getElementById('pie-chart-one').getContext('2d');
        window.pieChartOne = new Chart(pieChartOne, pieChartOneConfig);

        let pieChartTwo = document.getElementById('pie-chart-two').getContext('2d');
        window.pieChartTwo = new Chart(pieChartTwo, pieChartTwoConfig);
    };
</script>
